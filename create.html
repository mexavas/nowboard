<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>포스터 올리기 페이지</title>
    <link rel="stylesheet" href="./../css/global.css">
</head>

<body>
    <div class="myNavbar">
        <a href="./index.html" class="poster-link">인기포스터</a>
        <a href="./user/login.html" id="sign-in-link">로그인하세요</a>
    </div>
    <section>
        <div class="login-container">
            <h2>포스터를 올리기</h2>
        <form id="posterForm">
            <label for="posterTitle">제목:</label>
            <input type="text" id="posterTitle" name="posterTitle" placeholder="짧은 제목을 입력해주세요" required>
            <label for="posterFile">포스터 업로드:</label>
            <input type="file" id="posterFile" name="posterFile" accept="image/*" required>

            <!-- Button to trigger poster upload -->
            <button type="button" onclick="uploadPoster()">포스터 올리기</button>
        </form>
    </div>
    </section>

    <footer id="footer">
        &copy; 2023 백석대학교 <a href="#" id="logout"></a>
    </footer>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.1/firebase-storage.js"></script> 
    <script src="./javascript/firebase.js"></script>
    <script src="./javascript/navbar.js"></script>
    
    <script>


       function uploadPoster() {
    const title = document.getElementById('posterTitle').value;
    const fileInput = document.getElementById('posterFile');

    if (title && fileInput.files.length > 0) {
        const file = fileInput.files[0];
        const storage = firebase.storage(); // Corrected this line
        const storageRef = storage.ref(`posters/${file.name}`);
        const uploadTask = storageRef.put(file);

        uploadTask.on(
            'state_changed',
            (snapshot) => {
                // Progress tracking if needed
            },
            (error) => {
                console.error('Error uploading poster:', error);
            },
            () => {
                // Upload successful, now get the download URL
                storageRef.getDownloadURL().then((downloadURL) => {
                    // Save poster data to Firestore
                    const db = firebase.firestore();
                    db.collection('posters')
                        .add({
                            title: title,
                            posterURL: downloadURL,
                        })
                        .then(() => {
                            // redirect user to ./poster.html
                            window.location.href = './poster.html';
                            console.log('Poster uploaded successfully!');
                        })
                        .catch((error) => {
                            console.error('Error adding poster to Firestore:', error);
                        });
                });
            }
        );
    } else {
        console.error('Please provide a title and select a poster file.');
    }
}
    </script>
</body>

</html>
